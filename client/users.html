<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Users</title>

  <link rel="stylesheet" href="../css/layout.css">
  <link rel="stylesheet" href="../css/dashboard.css">
  <link rel="stylesheet" href="../css/users.css">
  <link rel="stylesheet" href="../css/sidebar.css">

</head>

<body>
  <div class="layout">
    <header class="header">
      <h1>User Management</h1>
      <div class="user-info">
        <span>Admin User</span>
        <div class="user-avatar">AU</div>
      </div>
    </header>

    <!-- Dynamic Sidebar (generated by sidebar.js) -->
    <aside class="sidebar" id="sidebar"></aside>



    <main class="main">

      <div class="content-section">

             <!-- TOP SWITCHER: Clients / Employees -->
            <div class="um-switcher um-switcher--top" role="tablist" aria-label="Clients/Employees Switcher">
            </div>

        <h2>My Team</h2>
        <p>Manage your teams</p>

        <!-- SWITCHER -->
        <div class="um-switcher" role="tablist" aria-label="Users Switcher">
        <button class="um-btn" type="button" id="openAddEmployee">
            Add Employee
        </button>
        </div>


        <!-- VIEW: ALL USERS -->
        <section id="tab-all" class="um-view is-active">
          <div class="um-table-wrap">
            <table class="um-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Full Name</th>
                  <th>Telegram</th>
                  <th>Email</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th style="text-align:right;">Actions</th>
                </tr>
              </thead>

              <tbody>
                <tr>
                  <td>#U-1001</td>
                  <td>Sarah Mitchell</td>
                  <td>@sarah_mitchell</td>
                  <td>sarah.mitchell@techvision.com</td>
                  <td><span class="um-badge um-badge--green">Active</span></td>
                  <td>2026-01-12</td>
                  <td style="text-align:right;">
                    <button class="um-btn um-btn--ghost" type="button"
                      data-edit
                      data-id="U-1001"
                      data-name="Sarah Mitchell"
                      data-company="TechVision Corp"
                      data-telegram="@sarah_mitchell"
                      data-email="sarah.mitchell@techvision.com"
                      data-phone="+1 (555) 234-5678"
                      data-country="United States"
                      data-status="Active"
                      data-spend="$284.5K"
                      data-value="$320K"
                      data-active-accounts="12"
                      data-engagement="98%">
                      Edit
                    </button>
                  </td>
                </tr>

                <tr>
                  <td>#U-1002</td>
                  <td>Michael Chen</td>
                  <td>@sarah_mitchell</td>
                  <td>michael.chen@brightlabs.io</td>
                  <td><span class="um-badge um-badge--gray">Pending</span></td>
                  <td>2026-01-20</td>
                  <td style="text-align:right;">
                    <button class="um-btn um-btn--ghost" type="button"
                      data-edit
                      data-id="U-1002"
                      data-name="Michael Chen"
                      data-company="BrightLabs"
                      data-telegram="@sarah_mitchell"
                      data-email="michael.chen@brightlabs.io"
                      data-phone="+44 20 7946 0000"
                      data-country="United Kingdom"
                      data-status="Pending"
                      data-spend="$12.0K"
                      data-value="$18K"
                      data-active-accounts="2"
                      data-engagement="61%">
                      Edit
                    </button>
                  </td>
                </tr>

                <tr>
                  <td>#U-1003</td>
                  <td>Emily Rodriguez</td>
                  <td>@sarah_mitchell</td>
                  <td>emily@northpeak.co</td>
                  <td><span class="um-badge um-badge--green">Active</span></td>
                  <td>2025-12-02</td>
                  <td style="text-align:right;">
                    <button class="um-btn um-btn--ghost" type="button"
                      data-edit
                      data-id="U-1003"
                      data-name="Emily Rodriguez"
                      data-company="NorthPeak"
                      data-telegram="@sarah_mitchell"
                      data-email="emily@northpeak.co"
                      data-phone="+34 600 123 123"
                      data-country="Spain"
                      data-status="Active"
                      data-spend="$98.2K"
                      data-value="$110K"
                      data-active-accounts="6"
                      data-engagement="87%">
                      Edit
                    </button>
                  </td>
                </tr>

              </tbody>
            </table>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- OVERLAY -->
  <div class="um-overlay" id="umOverlay" hidden></div>

  <!-- RIGHT DRAWER (Modal) -->
  <aside class="um-drawer" id="umDrawer" aria-hidden="true">
    <div class="um-drawer__header">
      <div>
        <div class="um-drawer__title">Client Details</div>
        <div class="um-drawer__subtitle" id="dId">#U-0000</div>
      </div>

      <div class="um-drawer__actions">
        <button class="um-btn" type="button" id="dEditBtn">Edit</button>
        <button class="um-btn um-btn--icon" type="button" id="dCloseBtn" aria-label="Close">✕</button>
      </div>
    </div>

    <div class="um-drawer__body">
      <div class="um-card um-profile">
        <div class="um-avatar">SM</div>
        <div class="um-profile__meta">
          <div class="um-profile__name" id="dName">Sarah Mitchell</div>
          <div class="um-profile__company" id="dCompany">TechVision Corp</div>
          <div class="um-profile__status" id="dStatus"><span class="um-badge um-badge--green">Active</span></div>
        </div>
      </div>

      <div class="um-card">
        <div class="um-card__title">Contact Information</div>
        <div class="um-info">
            <div class="um-info__row">
                <span class="um-info__label">Telegram</span>
                <span class="um-info__value" id="dTelegram">—</span>
            </div>
          <div class="um-info__row">
            <span class="um-info__label">Email</span>
            <span class="um-info__value" id="dEmail">—</span>
          </div>
          <div class="um-info__row">
            <span class="um-info__label">Phone</span>
            <span class="um-info__value" id="dPhone">—</span>
          </div>
          <div class="um-info__row">
            <span class="um-info__label">Country</span>
            <span class="um-info__value" id="dCountry">—</span>
          </div>
        </div>
      </div>

      <div class="um-card">
  <div class="um-card__title">Permissions</div>
  <div class="ae-sub" style="margin-top:-6px;">Viewer disables all edit permissions automatically.</div>

  <div class="permBox" id="dPerms">
    <div class="permRow" data-module="m1">
  <strong>Module #1</strong>

  <div class="permActions">
    <label class="permCheck"><input type="checkbox" class="perm-view" checked> View</label>
    <label class="permCheck"><input type="checkbox" class="perm-edit"> Edit</label>
    <label class="permCheck"><input type="checkbox" class="perm-del"> Delete</label>
  </div>
</div>


    <div class="permRow" data-module="m2">
  <strong>Module #2</strong>

  <div class="permActions">
    <label class="permCheck"><input type="checkbox" class="perm-view" checked> View</label>
    <label class="permCheck"><input type="checkbox" class="perm-edit"> Edit</label>
    <label class="permCheck"><input type="checkbox" class="perm-del"> Delete</label>
  </div>
</div>


    <div class="permRow" data-module="m3">
  <strong>Module #3</strong>

  <div class="permActions">
    <label class="permCheck"><input type="checkbox" class="perm-view" checked> View</label>
    <label class="permCheck"><input type="checkbox" class="perm-edit"> Edit</label>
    <label class="permCheck"><input type="checkbox" class="perm-del"> Delete</label>
  </div>
</div>

    <div class="permRow" data-module="m4">
  <strong>Module #4</strong>

  <div class="permActions">
    <label class="permCheck"><input type="checkbox" class="perm-view" checked> View</label>
    <label class="permCheck"><input type="checkbox" class="perm-edit"> Edit</label>
    <label class="permCheck"><input type="checkbox" class="perm-del"> Delete</label>
  </div>
</div>

  </div>
</div>


      <!-- Activity Logs -->
<div class="um-card">
  <div class="um-card__title">Activity Logs</div>

<div class="um-list" id="dLogs">
  <div class="um-list__item">
    <span>Updated fee settings</span>
    <strong>2026-02-12 14:22</strong>
  </div>

  <div class="um-list__item">
    <span>Placed support ticket</span>
    <strong>2026-02-12 13:10</strong>
  </div>

  <div class="um-list__item">
    <span>Created new request</span>
    <strong>2026-02-11 18:05</strong>
  </div>

  <div class="um-list__item">
    <span>Deleted account connection</span>
    <strong>2026-02-10 09:33</strong>
  </div>

  <div class="um-list__item">
    <span>Edited billing terms</span>
    <strong>2026-02-09 16:40</strong>
  </div>
</div>

</div>


    </div>
  </aside>

  <!-- OVERLAY pentru add employee (poți refolosi același overlay dacă vrei) -->
<div class="um-overlay" id="aeOverlay" hidden></div>

<!-- RIGHT DRAWER: Add Employee -->
<aside class="um-drawer" id="aeDrawer" aria-hidden="true">
  <div class="um-drawer__header">
    <div>
      <div class="um-drawer__title">Add Employee</div>
      <div class="um-drawer__subtitle">Invite flow (first login sets password)</div>
    </div>

    <div class="um-drawer__actions">
      <button class="um-btn um-btn--icon" type="button" id="aeCloseBtn" aria-label="Close">✕</button>
    </div>
  </div>

  <div class="um-drawer__body">

    <!-- User Details -->
    <div class="um-card">
      <div class="um-card__title">User Details</div>

      <div class="ae-grid">
        <div class="ae-field">
          <label>Full Name (set once)</label>
          <input id="aeFullName" type="text" placeholder="e.g. Sarah Mitchell">
        </div>

        <div class="ae-field">
          <label>Email</label>
          <input id="aeEmail" type="email" placeholder="e.g. sarah@company.com">
        </div>
      </div>

      <div class="ae-note">
        <strong>Important:</strong> Full Name is stored once (Firebase profile). At first login, user sets only password via invite link.
      </div>
    </div>

    <!-- Permissions -->
    <div class="um-card">
      <div class="um-card__title">Permissions</div>
      <div class="ae-sub">Viewer disables all edit permissions automatically.</div>

      <div class="ae-perms">
        <div class="ae-perm">
          <strong>Module #1</strong>
          <label class="ae-check"><input type="checkbox" class="ae-view" data-key="m1_view" checked> View</label>
          <label class="ae-check"><input type="checkbox" class="ae-edit" data-key="m1_edit"> Edit</label>
          <label class="ae-check"><input type="checkbox" data-key="m1_delete"> Delete</label>
        </div>

        <div class="ae-perm">
          <strong>Module #2</strong>
          <label class="ae-check"><input type="checkbox" class="ae-view" data-key="m2_view" checked> View</label>
          <label class="ae-check"><input type="checkbox" class="ae-edit" data-key="m2_edit"> Edit</label>
          <label class="ae-check"><input type="checkbox" data-key="m1_delete"> Delete</label>
        </div>

        <div class="ae-perm">
          <strong>Module #3</strong>
          <label class="ae-check"><input type="checkbox" class="ae-view" data-key="m3_view" checked> View</label>
          <label class="ae-check"><input type="checkbox" class="ae-edit" data-key="m3_edit"> Edit</label>
          <label class="ae-check"><input type="checkbox" data-key="m1_delete"> Delete</label>
        </div>

        <div class="ae-perm">
          <strong>Module #4</strong>
          <label class="ae-check"><input type="checkbox" class="ae-view" data-key="m4_view" checked> View</label>
          <label class="ae-check"><input type="checkbox" class="ae-edit" data-key="m4_edit"> Edit</label>
          <label class="ae-check"><input type="checkbox" data-key="m1_delete"> Delete</label>
        </div>
      </div>
    </div>

    <!-- Invite & Password -->
    <div class="um-card">
      <div class="um-card__title">Invite & Password</div>
      <div class="ae-sub">Send invite link for first login. Optionally send reset password link again later.</div>

      <div class="ae-actions">
        <button class="um-btn" type="button" id="aeSendInvite" disabled>Send Invite Link</button>
      </div>
    </div>
  </div>
  
<div class="ae-footer">
  <button class="um-btn um-btn--ghost" type="button" id="aeCancel">Cancel</button>
  <button class="um-btn" type="button" id="aeSave" disabled>Save</button>
</div>
</aside>




  <script>
    // Tabs
    const tabs = document.querySelectorAll(".um-tab");
    const views = {
      all: document.getElementById("tab-all"),
      add: document.getElementById("tab-add"),
    };

    tabs.forEach(btn => {
  btn.addEventListener("click", () => {
    // ✅ dacă e Add User, mergem pe pagina separată
    if (btn.dataset.tab === "add") {
      window.location.href = "user-add.html";
      return;
    }

    // normal: All Users
    tabs.forEach(t => {
      t.classList.remove("is-active");
      t.setAttribute("aria-selected", "false");
    });
    btn.classList.add("is-active");
    btn.setAttribute("aria-selected", "true");

    Object.values(views).forEach(v => v.classList.remove("is-active"));
    views.all.classList.add("is-active");
  });
});


    // Drawer / Modal
    const overlay = document.getElementById("umOverlay");
const drawer = document.getElementById("umDrawer");

const dId = document.getElementById("dId");
const dName = document.getElementById("dName");
const dCompany = document.getElementById("dCompany");
const dStatus = document.getElementById("dStatus");
const dEmail = document.getElementById("dEmail");
const dPhone = document.getElementById("dPhone");
const dTelegram = document.getElementById("dTelegram"); // ✅ ADD
const dCountry = document.getElementById("dCountry");
const dLogs = document.getElementById("dLogs");
const dSpend = document.getElementById("dSpend");
const dValue = document.getElementById("dValue");
const dActiveAccounts = document.getElementById("dActiveAccounts");
const dEngagement = document.getElementById("dEngagement");


function openDrawer(data) {
  dId.textContent = "#" + data.id;
  dName.textContent = data.name;
  dCompany.textContent = data.company;
  dEmail.textContent = data.email;
  dPhone.textContent = data.phone;
  dTelegram.textContent = data.telegram || "—"; // ✅ ADD
  dCountry.textContent = data.country;

  const isActive = (data.status || "").toLowerCase() === "active";
  dStatus.innerHTML = `<span class="um-badge ${isActive ? "um-badge--green" : "um-badge--gray"}">${data.status}</span>`;

    // init permissions rules in drawer
  dPermsBind();
  dPermsApplyRules();



  overlay.hidden = false;
  overlay.classList.add("is-open");
  drawer.classList.add("is-open");
  drawer.setAttribute("aria-hidden", "false");
}

function dPermsApplyRules(){
  const box = document.getElementById("dPerms");
  if(!box) return;

  box.querySelectorAll(".permRow").forEach(row => {
    const view = row.querySelector(".perm-view");
    const edit = row.querySelector(".perm-edit");
    const del  = row.querySelector(".perm-del");

    const allow = !!view.checked;

    // when View OFF -> Edit/Delete OFF + disabled
    [edit, del].forEach(ch => {
      ch.disabled = !allow;
      if(!allow) ch.checked = false;

      const wrap = ch.closest(".permCheck");
      if(wrap) wrap.classList.toggle("is-disabled", !allow);
    });
  });
}

function dPermsBind(){
  const box = document.getElementById("dPerms");
  if(!box) return;

  // bind once
  if(box.dataset.bound === "1") return;
  box.dataset.bound = "1";

  box.addEventListener("change", (e) => {
    if(e.target.classList.contains("perm-view")){
      dPermsApplyRules();
    }
  });

  dPermsApplyRules();
}



function closeDrawer() {
  overlay.hidden = true;
  overlay.classList.remove("is-open");
  drawer.classList.remove("is-open");
  drawer.setAttribute("aria-hidden", "true");
}

document.querySelectorAll("[data-edit]").forEach(btn => {
  btn.addEventListener("click", () => {
    openDrawer({
      id: btn.dataset.id,
      name: btn.dataset.name,
      company: btn.dataset.company,
      email: btn.dataset.email,
      phone: btn.dataset.phone,
      telegram: btn.dataset.telegram, // ✅ ADD
      country: btn.dataset.country,
      status: btn.dataset.status,
      spend: btn.dataset.spend,
      value: btn.dataset.value,
      activeAccounts: btn.dataset.activeAccounts,
      engagement: btn.dataset.engagement,
    });
  });
});

overlay.addEventListener("click", closeDrawer);
document.getElementById("dCloseBtn").addEventListener("click", closeDrawer);

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") closeDrawer();
});

// (Mock) Edit button in drawer
document.getElementById("dEditBtn").addEventListener("click", () => {
  alert("Next step: aici conectăm un form real de edit (separat / modal edit).");
});
</script>
<script>

    // Top switcher: Clients / Employees
document.querySelectorAll("[data-top-tab]").forEach(btn => {
  btn.addEventListener("click", () => {
    if (btn.dataset.topTab === "clients") {
      window.location.href = "clients.html";
    }
    // employees = pagina curentă → nimic
  });
});

</script>

<script>
    // ===== Add Employee Drawer =====
const aeOverlay = document.getElementById("aeOverlay");
const aeDrawer = document.getElementById("aeDrawer");
const openAddEmployee = document.getElementById("openAddEmployee");
const aeCloseBtn = document.getElementById("aeCloseBtn");

const aeFullName = document.getElementById("aeFullName");
const aeEmail = document.getElementById("aeEmail");
const aeTeam = document.getElementById("aeTeam");
const aeRole = document.getElementById("aeRole");

const aeSendInvite = document.getElementById("aeSendInvite");
const aeResetPass = document.getElementById("aeResetPass");
const aePreviewEmail = document.getElementById("aePreviewEmail");
const aePreviewBox = document.getElementById("aePreviewBox");
const aeEmailPreview = document.getElementById("aeEmailPreview");

function aeOpen(){
  aeOverlay.hidden = false;
  aeDrawer.classList.add("is-open");
  aeDrawer.setAttribute("aria-hidden", "false");
  aePreviewBox.style.display = "none";
}

function aeClose(){
  aeOverlay.hidden = true;
  aeDrawer.classList.remove("is-open");
  aeDrawer.setAttribute("aria-hidden", "true");
}

function aeGetPermissions(){
  const perms = {};
  aeDrawer.querySelectorAll("[data-key]").forEach(el => {
    perms[el.dataset.key] = !!el.checked;
  });
  return perms;
}

function aeApplyRoleRules(){
  const isViewer = (aeRole.value === "viewer");
  aeDrawer.querySelectorAll(".ae-edit").forEach(ch => {
    ch.checked = isViewer ? false : ch.checked;
    ch.disabled = isViewer;
  });
}

function aeValidate(){
  const nameOk = aeFullName.value.trim().length > 1;
  const email = aeEmail.value.trim();
  const emailOk = email.includes("@") && email.length > 5;

  const ok = nameOk && emailOk;
  aeSendInvite.disabled = !ok;
  aePreviewEmail.disabled = !ok;
  aeResetPass.disabled = !emailOk; // reset can work only with email
}

function aeBuildInviteLink(email){
  // mock link; firebase later
  return `https://app.example.com/invite?email=${encodeURIComponent(email)}&firstLogin=1`;
}

function aeBuildEmailText(){
  const fullName = aeFullName.value.trim() || "[Full Name]";
  const email = aeEmail.value.trim() || "[email]";
  const team = aeTeam.value.trim() || "Team X";
  const role = aeRole.value.toUpperCase();
  const perms = aeGetPermissions();
  const link = aeBuildInviteLink(email);

  return [
    `Subject: You're invited to join ${team}`,
    ``,
    `Hey ${fullName},`,
    ``,
    `You were invited to join the team "${team}".`,
    `Role: ${role}`,
    ``,
    `Permissions:`,
    JSON.stringify(perms, null, 2),
    ``,
    `Click below to set your password and access your dashboard:`,
    link
  ].join("\n");
}

openAddEmployee?.addEventListener("click", aeOpen);
aeOverlay?.addEventListener("click", aeClose);
aeCloseBtn?.addEventListener("click", aeClose);

document.addEventListener("keydown", (e) => {
  if (e.key === "Escape") aeClose();
});

aeRole?.addEventListener("change", aeApplyRoleRules);
[aeFullName, aeEmail, aeTeam].forEach(el => el?.addEventListener("input", aeValidate));

aeApplyRoleRules();
aeValidate();

aePreviewEmail?.addEventListener("click", () => {
  aePreviewBox.style.display = "block";
  aeEmailPreview.textContent = aeBuildEmailText();
});

aeSendInvite?.addEventListener("click", () => {
  aePreviewBox.style.display = "block";
  aeEmailPreview.textContent = aeBuildEmailText();
  alert("Mock: Invite link prepared. Next step: connect Firebase email invite flow.");
});

aeResetPass?.addEventListener("click", () => {
  alert(`Mock: reset password email would be sent to ${aeEmail.value.trim()}.`);
});

</script>


  <!-- Global Sidebar Script -->
  <script src="../js/sidebar.js"></script>

</body>
</html>