<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Fees</title>

  <link rel="stylesheet" href="../css/layout.css" />
  <link rel="stylesheet" href="../css/dashboard.css" />
  <link rel="stylesheet" href="../css/sidebar.css" />

  <style>
    .fees-container { 
      width: 100%; 
      padding: 1.5rem;
    }

    .page-header {
      margin-bottom: 1.5rem;
    }

    .page-header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .page-subtitle {
      color: #666;
      font-size: 0.95rem;
    }

    .fee-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 1200px) {
      .fee-stats { grid-template-columns: repeat(2, 1fr); }
    }

    @media (max-width: 768px) {
      .fee-stats { grid-template-columns: 1fr; }
    }

    .fee-stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      border-left: 4px solid #3498db;
    }

    .fee-stat-card.topup { border-left-color: #f59e0b; }
    .fee-stat-card.transfer { border-left-color: #10b981; }
    .fee-stat-card.setup { border-left-color: #6b7280; }

    .fee-stat-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #666;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    .fee-stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: #1a1a1a;
      margin-bottom: 0.25rem;
    }

    .fee-stat-desc {
      font-size: 0.85rem;
      color: #999;
    }

    .fees-actions {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 1.5rem;
    }

    .btn-add-fee {
      background: #3498db;
      color: white;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-add-fee:hover {
      background: #2980b9;
    }

    .fees-table-container {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      overflow: hidden;
    }

    .fees-table {
      width: 100%;
      border-collapse: collapse;
    }

    .fees-table thead {
      background: #f8f9fa;
    }

    .fees-table th {
      padding: 1rem;
      text-align: left;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #666;
      font-weight: 600;
      border-bottom: 2px solid #e5e7eb;
    }

    .fees-table td {
      padding: 1rem;
      border-bottom: 1px solid #f0f0f0;
      vertical-align: middle;
    }

    .fees-table tbody tr:hover {
      background: #f8f9fa;
    }

    .fee-type-badge {
      display: inline-block;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    .fee-type-badge.topup {
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
    }

    .fee-type-badge.transfer {
      background: rgba(16, 185, 129, 0.15);
      color: #10b981;
    }

    .fee-type-badge.setup {
      background: rgba(107, 114, 128, 0.15);
      color: #6b7280;
    }

    .fee-code {
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      color: #666;
    }

    .fee-link {
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      color: #3498db;
      text-decoration: none;
    }

    .fee-link:hover {
      text-decoration: underline;
    }

    .btn-details {
      background: #f0f0f0;
      color: #333;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-details:hover {
      background: #e0e0e0;
    }

    .fee-note {
      margin-top: 1.5rem;
      padding: 1rem;
      background: #f8f9fa;
      border-left: 4px solid #3498db;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #666;
      line-height: 1.6;
    }

    /* Tab Styles - matching other pages */
    .page-tabs{
      display:flex;
      gap:8px;
      padding:6px;
      border-radius:999px;
      border:1px solid rgba(15,23,42,.07);
      background: rgba(255,255,255,.72);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      width: fit-content;
    }

    .page-tab{
      border:1px solid transparent;
      background: transparent;
      color: #64748b;
      padding: 10px 14px;
      border-radius: 999px;
      font-weight: 950;
      cursor:pointer;
      transition: background .12s ease, color .12s ease, border-color .12s ease, transform .12s ease;
      letter-spacing: .2px;
      user-select:none;
    }

    .page-tab:hover{ 
      transform: translateY(-1px); 
    }

    .page-tab.active{
      background: rgba(37,99,235,.18);
      border-color: rgba(37,99,235,.25);
      color: #0f172a;
    }
  </style>
</head>

<body>
  <div class="layout">
    <header class="header">
      <div class="page-tabs" id="pageTabs" role="tablist" aria-label="Finance tabs">
        <button type="button" class="page-tab" data-page="topups" role="tab" aria-selected="false">Topups</button>
        <button type="button" class="page-tab" data-page="finance" role="tab" aria-selected="false">Finance</button>
        <button type="button" class="page-tab" data-page="income" role="tab" aria-selected="false">Income</button>
        <button type="button" class="page-tab active" data-page="fees" role="tab" aria-selected="true">Charges</button>
        <button type="button" class="page-tab" data-page="internal-transactions" role="tab" aria-selected="false">Internal Transactions</button>
        <button type="button" class="page-tab" data-page="transactions" role="tab" aria-selected="false">Transactions</button>
      </div>

      <div class="header-right">
        <div class="theme-toggle">
          <button class="theme-btn active">Light</button>
          <button class="theme-btn">Dark</button>
        </div>
        <div class="user-info">
          <span>Admin User</span>
          <div class="user-avatar">AU</div>
        </div>
      </div>
    </header>

    <aside class="sidebar" id="sidebar"></aside>

    <main class="main">
      <div class="fees-container">
        <div class="page-header">
          <h1>Charges</h1>
        </div>

        <!-- Fee Statistics -->
        <div class="fee-stats">
          <div class="fee-stat-card">
            <div class="fee-stat-label">Total Fees</div>
            <div class="fee-stat-value">$ 25.00</div>
          </div>

          <div class="fee-stat-card topup">
            <div class="fee-stat-label">Top-Up Fees</div>
            <div class="fee-stat-value">$ 20.00</div>
          </div>

          <div class="fee-stat-card transfer">
            <div class="fee-stat-label">Transfer Fees</div>
            <div class="fee-stat-value">$ 5.00</div>
          </div>

          <div class="fee-stat-card setup">
            <div class="fee-stat-label">Setup + Services</div>
            <div class="fee-stat-value">$ 0.00</div>
          </div>
        </div>

        <!-- Add Fee Button -->
        <div class="fees-actions">
          <button class="btn-add-fee" onclick="openAddServiceFeeModal()">+ Add Service Fee</button>
        </div>

        <!-- Fees Table -->
        <div class="fees-table-container">
          <table class="fees-table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Amount</th>
                <th>Fee Code</th>
                <th>Link</th>
                <th>Description</th>
                <th style="text-align: center;">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>19 februarie 2026</td>
                <td>
                  <span class="fee-type-badge topup">TOPUP</span>
                </td>
                <td style="font-weight: 700;">$ 20.00</td>
                <td class="fee-code">TOPUP_WIRE</td>
                <td>
                  <a href="#" class="fee-link">TOPUPTU-DEMO-1</a>
                </td>
                <td>Demo > Top-up fee</td>
                <td style="text-align: center;">
                  <button class="btn-details" onclick="openFeeDetailsModal('TOPUP', '$ 20.00', 'TOPUP_WIRE', 'TOPUPTU-DEMO-1', 'Demo > Top-up fee', '19 februarie 2026')">Details</button>
                </td>
              </tr>

              <tr>
                <td>19 februarie 2026</td>
                <td>
                  <span class="fee-type-badge transfer">TRANSFER</span>
                </td>
                <td style="font-weight: 700;">$ 5.00</td>
                <td class="fee-code">TRANSFER_MAIN_TO_VAULT</td>
                <td>
                  <a href="#" class="fee-link">TRANSFERTR-DEMO-1</a>
                </td>
                <td>Demo > Transfer fee</td>
                <td style="text-align: center;">
                  <button class="btn-details" onclick="openFeeDetailsModal('TRANSFER', '$ 5.00', 'TRANSFER_MAIN_TO_VAULT', 'TRANSFERTR-DEMO-1', 'Demo > Transfer fee', '19 februarie 2026')">Details</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </main>
  </div>

  <!-- Fee Details Modal (Right Side Panel) -->
  <div id="feeDetailsModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; backdrop-filter: blur(4px);" onclick="closeFeeDetailsModal()">
    <div id="feeDetailsPanel" style="position: absolute; top: 0; right: -600px; width: 600px; height: 100%; background: white; box-shadow: -4px 0 20px rgba(0,0,0,0.2); transition: right 0.3s ease; overflow-y: auto;" onclick="event.stopPropagation()">
      
      <!-- Header -->
      <div style="padding: 2rem; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; background: white; z-index: 10;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h3 id="detailTitle" style="margin: 0; font-size: 1.1rem; font-weight: 600; color: #1f2937;">Fee entry • 25d6e69b-c1e1-4fad-8bab-77d23436199e</h3>
          <button onclick="closeFeeDetailsModal()" style="background: none; border: none; font-size: 1rem; color: #6b7280; cursor: pointer; padding: 0.5rem 1rem; font-weight: 500; transition: all 0.15s;" onmouseover="this.style.color='#1f2937'" onmouseout="this.style.color='#6b7280'">Close</button>
        </div>
      </div>

      <!-- Content -->
      <div style="padding: 2rem;">
        
        <!-- Field: Created -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f3f4f6;">
          <span style="color: #9ca3af; font-size: 0.95rem;">Created</span>
          <span id="detailCreated" style="color: #1f2937; font-weight: 600; font-size: 0.95rem;">19 februarie 2026</span>
        </div>

        <!-- Field: Category -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f3f4f6;">
          <span style="color: #9ca3af; font-size: 0.95rem;">Category</span>
          <span id="detailCategory" style="color: #1f2937; font-weight: 600; font-size: 0.95rem;">TOPUP_FEE</span>
        </div>

        <!-- Field: Amount -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f3f4f6;">
          <span style="color: #9ca3af; font-size: 0.95rem;">Amount</span>
          <span id="detailAmount" style="color: #1f2937; font-weight: 600; font-size: 0.95rem;">$ 20.00</span>
        </div>

        <!-- Field: From -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f3f4f6;">
          <span style="color: #9ca3af; font-size: 0.95rem;">From</span>
          <span id="detailFrom" style="color: #1f2937; font-weight: 600; font-size: 0.95rem;">Top-up</span>
        </div>

        <!-- Field: To -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f3f4f6;">
          <span style="color: #9ca3af; font-size: 0.95rem;">To</span>
          <span id="detailTo" style="color: #1f2937; font-weight: 600; font-size: 0.95rem;">Fees</span>
        </div>

        <!-- Field: Fee code -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f3f4f6;">
          <span style="color: #9ca3af; font-size: 0.95rem;">Fee code</span>
          <span id="detailFeeCode" style="color: #1f2937; font-weight: 600; font-size: 0.95rem;">TOPUP_WIRE</span>
        </div>

        <!-- Field: Link -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f3f4f6;">
          <span style="color: #9ca3af; font-size: 0.95rem;">Link</span>
          <span id="detailLink" style="color: #1f2937; font-weight: 600; font-size: 0.95rem;">TOPUP:TU-DEMO-1</span>
        </div>

        <!-- Field: Description -->
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid #f3f4f6;">
          <span style="color: #9ca3af; font-size: 0.95rem;">Description</span>
          <span id="detailDescription" style="color: #1f2937; font-weight: 600; font-size: 0.95rem; text-align: right;">Demo • Top-up fee</span>
        </div>

      </div>

    </div>
  </div>

  <!-- Add Service Fee Modal (Right Side Panel) -->
  <div id="addServiceFeeModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; backdrop-filter: blur(4px);" onclick="closeAddServiceFeeModal()">
    <div id="addServiceFeePanel" style="position: absolute; top: 0; right: -600px; width: 600px; height: 100%; background: white; box-shadow: -4px 0 20px rgba(0,0,0,0.2); transition: right 0.3s ease; overflow-y: auto;" onclick="event.stopPropagation()">
      
      <!-- Header -->
      <div style="padding: 2rem; border-bottom: 1px solid #e5e7eb; position: sticky; top: 0; background: white; z-index: 10;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <h3 style="margin: 0; font-size: 1.3rem; font-weight: 700; color: #1f2937;">Add service fee</h3>
          <button onclick="closeAddServiceFeeModal()" style="background: none; border: none; font-size: 1.5rem; color: #6b7280; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 6px; transition: all 0.15s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='none'">×</button>
        </div>
      </div>

      <!-- Form Content -->
      <div style="padding: 2rem;">
        
        <!-- Row 1: Client, Service name, Amount, Fee code -->
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem;">
          <div>
            <label style="display: block; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; font-weight: 500;">Client</label>
            <select id="feeClient" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; background: white; color: #1f2937; font-size: 0.95rem;">
              <option value="100">Alex M.</option>
              <option value="101">Maria S.</option>
              <option value="102">John D.</option>
            </select>
          </div>

          <div>
            <label style="display: block; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; font-weight: 500;">Service name</label>
            <input type="text" id="feeServiceName" placeholder="Service" value="Service" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; background: white; color: #1f2937; font-size: 0.95rem;">
          </div>

          <div>
            <label style="display: block; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; font-weight: 500;">Amount ($)</label>
            <input type="number" id="feeAmount" placeholder="50" value="50" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; background: white; color: #1f2937; font-size: 0.95rem;">
          </div>

          <div>
            <label style="display: block; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; font-weight: 500;">Fee code</label>
            <input type="text" id="feeFeeCode" placeholder="SERVICE" value="SERVICE" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; background: white; color: #1f2937; font-size: 0.95rem;">
          </div>
        </div>

        <!-- Note (optional) -->
        <div style="margin-bottom: 2rem;">
          <label style="display: block; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; font-weight: 500;">Note (optional)</label>
          <textarea id="feeNote" placeholder="Optional..." rows="3" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; background: white; color: #1f2937; font-size: 0.95rem; resize: vertical;"></textarea>
        </div>

        <!-- Summary Section -->
        <div style="background: #f9fafb; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <span style="color: #6b7280; font-size: 0.95rem;">From</span>
            <span style="color: #1f2937; font-weight: 700; font-size: 1rem;">Main Wallet</span>
          </div>

          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <span style="color: #6b7280; font-size: 0.95rem;">To</span>
            <span style="color: #1f2937; font-weight: 700; font-size: 1rem;">Fees</span>
          </div>

          <div style="height: 1px; background: #e5e7eb; margin: 1rem 0;"></div>

          <div style="display: flex; justify-content: space-between; align-items: center;">
            <span style="color: #6b7280; font-size: 0.95rem;">Total</span>
            <span style="color: #1f2937; font-weight: 700; font-size: 1.25rem;">$ <span id="feeTotalAmount">50.00</span></span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div style="display: flex; gap: 1rem;">
          <button onclick="submitAddServiceFee()" style="flex: 1; background: #3b82f6; color: white; padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; font-size: 1rem; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#2563eb'" onmouseout="this.style.background='#3b82f6'">Add fee</button>
          <button onclick="closeAddServiceFeeModal()" style="flex: 0.5; background: #f3f4f6; color: #6b7280; padding: 12px 24px; border: none; border-radius: 8px; font-weight: 600; font-size: 1rem; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#e5e7eb'" onmouseout="this.style.background='#f3f4f6'">Cancel</button>
        </div>

      </div>

    </div>
  </div>

  <script src="../js/sidebar.js"></script>
  <script>
    /* ==============================
       Page tabs navigation
    ============================== */
    const PAGE_ROUTES = {
      topups: "topups.html",
      finance: "finance.html",
      income: "income.html",
      fees: "fees.html",
      "internal-transactions": "internal-transactions.html",
      transactions: "transactions.html"
    };

    function getCurrentFileName(){
      const p = window.location.pathname || "";
      const parts = p.split("/");
      return (parts[parts.length - 1] || "").toLowerCase();
    }
    function detectActivePage(){
      const file = getCurrentFileName();
      for (const [key, filename] of Object.entries(PAGE_ROUTES)){
        if ((filename || "").toLowerCase() === file) return key;
      }
      return "fees";
    }
    function setActiveTabUI(activeKey){
      document.querySelectorAll("#pageTabs .page-tab").forEach(btn=>{
        const isOn = btn.dataset.page === activeKey;
        btn.classList.toggle("active", isOn);
        btn.setAttribute("aria-selected", isOn ? "true" : "false");
      });
    }
    function navigateTo(key){
      const target = PAGE_ROUTES[key];
      if(!target) return;
      window.location.href = target;
    }
    
    setActiveTabUI(detectActivePage());

    document.getElementById("pageTabs")?.addEventListener("click", (e)=>{
      const btn = e.target.closest(".page-tab");
      if(!btn) return;
      const key = btn.dataset.page;
      setActiveTabUI(key);
      if(key === detectActivePage()) return;
      navigateTo(key);
    });

    /* ==============================
       Fee Details Modal Functions
    ============================== */
    function openFeeDetailsModal(type, amount, feeCode, link, description, date){
      const modal = document.getElementById("feeDetailsModal");
      const panel = document.getElementById("feeDetailsPanel");
      
      // Generate a random ID for the title
      const randomId = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
      
      // Populate data
      document.getElementById("detailTitle").textContent = `Fee entry • ${randomId}`;
      document.getElementById("detailCreated").textContent = date;
      document.getElementById("detailCategory").textContent = type + "_FEE";
      document.getElementById("detailAmount").textContent = amount;
      document.getElementById("detailFrom").textContent = type === "TOPUP" ? "Top-up" : "Transfer";
      document.getElementById("detailTo").textContent = "Fees";
      document.getElementById("detailFeeCode").textContent = feeCode;
      document.getElementById("detailLink").textContent = link;
      document.getElementById("detailDescription").textContent = description;
      
      modal.style.display = "block";
      
      // Trigger animation after display
      setTimeout(() => {
        panel.style.right = "0";
      }, 10);
    }

    function closeFeeDetailsModal(){
      const modal = document.getElementById("feeDetailsModal");
      const panel = document.getElementById("feeDetailsPanel");
      
      // Animate out
      panel.style.right = "-600px";
      
      // Hide after animation
      setTimeout(() => {
        modal.style.display = "none";
      }, 300);
    }

    /* ==============================
       Add Service Fee Modal Functions
    ============================== */
    function openAddServiceFeeModal(){
      const modal = document.getElementById("addServiceFeeModal");
      const panel = document.getElementById("addServiceFeePanel");
      modal.style.display = "block";
      
      // Trigger animation after display
      setTimeout(() => {
        panel.style.right = "0";
      }, 10);
    }

    function closeAddServiceFeeModal(){
      const modal = document.getElementById("addServiceFeeModal");
      const panel = document.getElementById("addServiceFeePanel");
      
      // Animate out
      panel.style.right = "-600px";
      
      // Hide after animation
      setTimeout(() => {
        modal.style.display = "none";
      }, 300);
    }

    function submitAddServiceFee(){
      const client = document.getElementById("feeClient").value;
      const serviceName = document.getElementById("feeServiceName").value;
      const amount = document.getElementById("feeAmount").value;
      const feeCode = document.getElementById("feeFeeCode").value;
      const note = document.getElementById("feeNote").value;

      // Here you would normally send this data to your backend
      console.log("Adding service fee:", { client, serviceName, amount, feeCode, note });
      
      alert(`Service fee added successfully!\nClient: ${client}\nAmount: $ ${amount}\nFee Code: ${feeCode}`);
      
      closeAddServiceFeeModal();
    }

    // Update total amount when amount field changes
    document.getElementById("feeAmount")?.addEventListener("input", (e) => {
      const amount = parseFloat(e.target.value) || 0;
      document.getElementById("feeTotalAmount").textContent = amount.toFixed(2);
    });
  </script>
</body>
</html>
